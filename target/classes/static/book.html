<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book a Service - MaxWheels</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" 
     integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" 
     crossorigin="anonymous">
    </script>
    <script src="jquery_cookie.js"></script>
    <script src="main.js"></script>
  </head>
  <body>
    <!------------------------HEADER-------------------------->
 <!-- HEADER -->
 <header class="header">
  <div id="menu-btn">
    <i class="fa-solid fa-bars"></i>
  </div>

  <a href="#" class="logo"><span>max</span>wheels </a>
  <nav class="navbar" style="text-decoration:none;">
    <a href="index.html">Home</a>
    <a href="history.html">History</a>
    <a href="profile.html">Profile</a>
    <a href="index.html/#contact">Contact</a>
  </nav>

  <div id="login-btn">
    <a href="login.html">
      <button class="btn">Login</button>
      <i class="far fa-user"></i>
    </a>
  </div>
  <div id="register-btn">
    <a href="register.html">
      <button class="btn">Register</button>
      <i class="fa-solid fa-user-plus"></i>
    </a>
  </div>
  <div>
    <a href="history.html"><button style="font-size:1.5rem; cursor:pointer; background:none;"><i class="fa-solid fa-cart-shopping"></i> Cart</button></a>
  </div>
</header>
    <!------------------------END OF HEADER------------------->
    
    <!-- Booking Section -->
    <section class="booking-section">
      <div class="container">
        <br>
        <br>
        <br>
        <h4 class="heading">Book a <span>Service</span></h4>
        <div class="booking-container">
          <div class="booking-form-container">
            <div class="card">
              <h2><i class="fas fa-calendar-check"></i> Schedule Your Service</h2>
              <div id="error-message" class="alert alert-danger" style="display: none;"></div>
              <div id="success-message" class="alert alert-success" style="display: none;"></div>
              <form id="booking-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="vehicleType"><i class="fas fa-car"></i> Vehicle Type</label>
                    <select id="vehicleType" class="form-control" required>
                      <option value="">Select type...</option>
                      <option value="CAR">Car</option>
                      <option value="BIKE">Bike</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="vehicleModel"><i class="fas fa-tags"></i> Vehicle Model</label>
                    <input type="text" id="vehicleModel" class="form-control" placeholder="e.g. Toyota Camry" required>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="vehicleNumber"><i class="fas fa-id-card"></i> Vehicle Number</label>
                    <input type="text" id="vehicleNumber" class="form-control" placeholder="e.g. ABC-1234" required>
                  </div>
                </div>
                <div class="form-group">
                  <label for="serviceType"><i class="fas fa-tools"></i> Service Type</label>
                  <select id="serviceType" class="form-control" required>
                    <option value="">Choose a service...</option>
                    <option value="OIL_CHANGE">Oil Change</option>
                    <option value="BATTERY_REPLACEMENT">Battery Replacement</option>
                    <option value="TIRE_ROTATION">Tire Rotation</option>
                    <option value="WASHING">Washing</option>
                    <option value="PARTS_REPAIR">Parts Repair</option>
                    <option value="BRAKE_INSPECTION">Brake Inspection</option>
                    <option value="ENGINE_REPAIR">Engine Repair</option>
                    <option value="CAR_INSURANCE">Car Insurance</option>
                    <option value="CAR_RENTAL">Car Rental</option>
                    <option value="OTHER">Other</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" name="description" rows="5" cols="100" placeholder="Any special requests or notes"></textarea>
            </div>
            
            <button type="submit" class="btn" name="submit-booking">Book Service</button>
          </form>
        </div>
        
        <div class="booking-info">
          <h3>Booking Information</h3>
          <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <p>All bookings require a valid driver's license and credit card at pickup.</p>
          </div>
          
          <div class="info-box">
            <i class="fas fa-clock"></i>
            <p>Standard pickup and return hours: 8:00 AM - 6:00 PM</p>
          </div>
          
          <div class="info-box">
            <i class="fas fa-dollar-sign"></i>
            <p>A deposit of $200 will be held on your credit card during the rental period.</p>
          </div>
          
          <div class="info-box">
            <i class="fas fa-gas-pump"></i>
            <p>All vehicles are provided with a full tank of gas and should be returned with a full tank.</p>
          </div>
          
          <div class="info-box">
            <i class="fas fa-phone"></i>
            <p>For assistance with your booking, please call our customer service at 1-800-MAX-WHEELS.</p>
          </div>
        </div>
      </div>
    </section>
    <script src="/js/session.js"></script>
    <script>
        document.getElementById('booking-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            const bookingData = {
                vehicleType: document.getElementById('vehicleType').value,
                vehicleModel: document.getElementById('vehicleModel').value,
                vehicleNumber: document.getElementById('vehicleNumber').value,
                serviceType: document.getElementById('serviceType').value,
                description: document.getElementById('description').value
            };

            try {
                const response = await fetch('/api/service-requests', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(bookingData)
                });

                const data = await response.json();

                if (response.ok) {
                    successMessage.textContent = 'Booking successful!';
                    successMessage.style.display = 'block';
                    document.getElementById('booking-form').reset();
                } else {
                    errorMessage.textContent = data.message || 'Booking failed';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'An error occurred. Please try again.';
                errorMessage.style.display = 'block';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            checkSession().then(user => {
                if (!user || !user.roles || !user.roles.includes('ROLE_USER')) {
                    window.location.href = '/login.html';
                } else {
                    // Any additional logic to initialize the booking form can go here
                }
            });
        });
    </script>
  </body>
</html>